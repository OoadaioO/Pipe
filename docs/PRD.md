# Pipe 游戏产品需求文档 (PRD)

## 1. 产品概述

**项目名称**: Pipe  
**项目类型**: 3D 无尽跑酷游戏  
**目标平台**: PC/移动端  
**开发引擎**: Unity 2022.3+ LTS  
**应用标识**: com.xb.galactic.glide

### 1.1 游戏概念
Pipe 是一款基于程序化生成管道的 3D 跑酷游戏。玩家控制角色在不断生成的弯曲管道中前进，通过旋转操作避开障碍物，挑战最远距离记录。游戏采用卡通渲染风格，提供流畅的视觉体验。

### 1.2 核心玩法
- **无尽跑酷**: 角色自动前进，管道无限生成
- **旋转控制**: 玩家通过鼠标或键盘控制角色绕管道旋转
- **障碍躲避**: 避开管道上的各种障碍物和陷阱
- **距离挑战**: 以行进距离(米)作为主要评分标准
- **最佳记录**: 自动保存并显示历史最佳成绩

### 1.3 目标用户
- 休闲游戏玩家
- 喜欢跑酷类游戏的用户
- 寻求简单操作但富有挑战性游戏的玩家

## 2. 核心功能需求

### 2.1 游戏玩法

#### 2.1.1 基础移动机制
- **自动前进**: 玩家角色沿管道自动向前移动
- **旋转控制**: 玩家可以控制角色绕管道轴心旋转
- **速度管理**: 游戏速度随时间或距离逐渐增加
- **死亡重生**: 角色死亡后播放粒子效果，倒计时后重新开始

#### 2.1.2 输入系统
- **鼠标控制**: 支持鼠标水平移动控制旋转
- **键盘控制**: 支持水平轴输入(A/D键或方向键)
- **输入抽象**: 统一的FrameInput结构处理不同输入源
- **实时响应**: 每帧更新输入状态，确保流畅控制

#### 2.1.3 碰撞检测
- **障碍物碰撞**: 角色碰到障碍物时触发死亡事件
- **Avatar系统**: 独立的视觉表现层处理死亡动画
- **事件驱动**: 基于Unity事件系统的碰撞响应

### 2.2 管道系统

#### 2.2.1 程序化生成
- **动态创建**: 使用PipeSystem管理管道的生成和切换
- **弯曲设计**: 支持自定义弯曲半径、角度和分段数
- **无缝连接**: 通过SetupNextPipe实现管道间的精确对齐
- **高性能**: 基于Unity Job System和Burst编译器的网格生成

#### 2.2.2 管道配置
- **参数化设计**: 可配置管道半径、弯曲半径、环间距等
- **分段控制**: 支持弯曲分段数和管道分段数的独立设置
- **实时预览**: 编辑器中可实时预览管道生成效果

### 2.3 物品系统

#### 2.3.1 物品生成
- **生成器模式**: 基于PipeItemGenerator抽象类的可扩展设计
- **多种布局**: 支持随机布局(RandomPlacer)和螺旋布局(SpiralPlacer)
- **精确定位**: 通过IPlaceable接口实现物品在管道上的精确定位

#### 2.3.2 动态物品
- **移动效果**: MovePipeItem支持基于时间的振荡运动
- **可配置参数**: 支持自定义移动速度和振幅

### 2.4 角色系统

#### 2.4.1 Player控制层
- **旋转机制**: 基于输入控制角色绕管道轴心旋转
- **管道跟随**: 自动跟随当前管道的位置和方向
- **状态管理**: 管理游戏开始、进行中、死亡等状态
- **距离追踪**: 实时计算并广播行进距离

#### 2.4.2 Avatar表现层
- **视觉分离**: 独立的视觉表现层，与逻辑层解耦
- **死亡效果**: 死亡时播放粒子特效
- **重生机制**: 倒计时后自动重新激活角色
- **动画系统**: 支持角色的各种动画状态

### 2.3 游戏模式

#### 2.3.1 无尽模式
- **渐进难度**: 游戏速度逐渐增加
- **多种加速度**: 支持不同的加速度配置
- **高分挑战**: 以距离为评分标准

### 2.4 用户界面

#### 2.4.1 主界面
- **开始游戏**: 新游戏按钮
- **游戏结束对话框**: 显示游戏结束信息
- **重新开始**: 快速重新开始功能

#### 2.4.2 游戏内UI
- **简洁设计**: 最小化UI干扰，专注游戏体验
- **实时反馈**: 通过视觉和粒子效果提供即时反馈

### 2.5 UI系统

#### 2.5.1 游戏内UI
- **距离显示**: 实时显示当前行进距离(米)
- **最佳成绩**: 显示历史最佳距离记录
- **动态更新**: 基于事件系统的实时UI更新

#### 2.5.2 游戏结束UI
- **死亡对话框**: 游戏结束时显示结果界面
- **重新开始**: 提供"New Game"按钮重新开始游戏
- **成绩对比**: 显示当前成绩与最佳成绩的对比

### 2.6 音频系统

#### 2.6.1 背景音乐
- **淡入淡出**: 支持音乐的平滑淡入淡出效果
- **音量控制**: 可配置的淡入淡出时长
- **循环播放**: 背景音乐循环播放

#### 2.6.2 音效系统
- **游戏结束音效**: 角色死亡时播放专用音效
- **一次性播放**: 使用PlayOneShot播放短音效
- **独立音源**: 音效与背景音乐使用独立的AudioSource

## 3. 技术特性

### 3.1 渲染系统
- **URP渲染管线**: 使用Universal Render Pipeline
- **卡通渲染**: 集成Toon Shader实现卡通风格
- **边缘检测**: 自定义EdgeDetect渲染特性
- **轮廓渲染**: OutlineShader提供物体轮廓效果
- **后处理**: 支持自定义渲染通道和效果

### 3.2 性能优化
- **Job System**: 使用Unity Job System进行多线程计算
- **Burst编译**: 关键计算使用Burst编译器优化
- **程序化生成**: 运行时动态生成管道网格
- **内存管理**: 高效的网格数据管理和释放

### 3.3 数据持久化
- **本地存储**: 使用PlayerPrefs保存游戏数据
- **最佳成绩**: 自动保存和加载历史最佳距离
- **即时保存**: 成绩更新时立即保存到本地
- **事件通知**: 数据变化时触发相应事件

### 3.4 平台支持
- **多平台构建**: 支持PC、Android等平台
- **输入抽象**: 统一的输入处理系统
- **分辨率适配**: 支持不同分辨率和屏幕比例
- **性能调节**: 根据设备性能自动调整画质

## 4. 用户体验设计

### 4.1 操作体验
- **简单易学**: 单一操作机制，易于上手
- **精确控制**: 响应式的旋转控制
- **流畅感**: 平滑的动画和过渡效果

### 4.2 视觉体验
- **现代渲染**: 使用URP渲染管线
- **粒子效果**: 丰富的视觉反馈
- **色彩搭配**: 清晰的视觉层次

### 4.3 音效体验
- **预留接口**: 支持音效系统扩展
- **反馈机制**: 为碰撞和移动预留音效触发点

## 5. 扩展性设计

### 5.1 内容扩展
- **模块化设计**: 障碍物和道具系统支持轻松添加新内容
- **生成器模式**: 支持新的障碍物布局模式
- **材质系统**: 支持不同主题的视觉风格

### 5.2 功能扩展
- **多游戏模式**: 架构支持添加新的游戏模式
- **成就系统**: 预留成就和统计系统接口
- **社交功能**: 支持排行榜等社交功能扩展

## 6. 成功指标

### 6.1 用户参与度
- 平均游戏时长
- 重复游戏率
- 用户留存率

### 6.2 技术指标
- 游戏性能稳定性
- 加载时间
- 内存使用效率

### 6.3 用户反馈
- 操作流畅度评价
- 难度曲线合理性
- 视觉效果满意度